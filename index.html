<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HI</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"
            integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="https://cdn.gravitec.net/sites/gudz/client.js" async></script>
</head>
<body>
<div id="timerContainer"><span id="timer">10</span> sec to subscribe</div>
<div id="tagscontainer" style="display: none">
    <p>
        <input type="text">
        <button class="add">Add tag</button>
    </p>
    <p style="margin-top: 20px;">
        <button class="removeAll">Remove all tags</button>
    </p>
</div>
<div id="apiStack" style="position: fixed; top: 0;right: 0; border: 1px solid black; padding: 10px;width: 400px;"></div>
<script>
    var secs = 10;
    var timeContainer = $('#timer');
    var tagsContainer = $("#tagscontainer");
    var apiStack = $('#apiStack');
    var Gravitec = Gravitec || [];
    Gravitec.push(["init", {"autoRegister": false}]);
    apiStack.append('<p>var Gravitec = Gravitec || [];<br/>Gravitec.push(["init", {"autoRegister": false}]);</p>')
    var interval = setInterval(function () {
        if (secs > 0) {
            secs--;
            timeContainer.innerHTML = secs;
        }
        else {
            clearInterval(interval);
            onTimeout();
        }
    }, 1000);

    function onTimeout() {
        Gravitec.push(["registerUserForPush", onSubscribed]);
        apiStack.append('<p>Gravitec.push(["registerUserForPush", onSubscribed]);</p>');
    }

    function onTagAdd() {
        var val = tagsContainer.find('input').val();
        if (val) {
            Gravitec.push(['addTag', val]);
            apiStack.append('<p>Gravitec.push(["addTag", "' + val + '"]);</p>');
        }
        else {
            alert('Tag entered is empty');
        }
    }

    function onTagsRemove() {
        Gravitec.push(["removeAllTags"]);
        apiStack.append('<p>Gravitec.push(["removeAllTags"]);</p>');
    }

    function onSubscribed() {
        apiStack.append('<p>onSubscribed function triggered</p>');
        $('#timerContainer').hide();
        tagsContainer.show();
        tagsContainer.find('button.add').on('click', onTagAdd);
        tagsContainer.find('button.removeAll').on('click', onTagsRemove);
        alert('Thank you for subscription ;) You can add a tag!')
    }
</script>
</body>
</html>
